<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}samaCOFFRE - Conditions Générales d'Utilisation et de Vente{% endblock %}</title>
        <meta name="description" content="Distribution De Courriers Electroniques D'Entreprise">
        
         <!-- Drozone -->
        <script src="{{ asset('js/dropzone.js') }}"></script>
        <link rel="stylesheet" href="{{ asset('css/dropzone.css') }}">
                
        
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
       
        <!-- jQuery UI -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
        <!-- jQuery Datepicker -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js" type="text/javascript"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js" integrity="sha256-JIBDRWRB0n67sjMusTy4xZ9L09V8BINF0nd/UUUOi48=" crossorigin="anonymous"></script>

        <!-- CSS - Bootstrap, JQuery UI-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
       
        
        {% block stylesheets %}
            
            <style>
                
                .img {
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    -khtml-border-radius: 4px;
    border-radius: 4px;
}
{#                Ecrire sur image#}

                .contenant {
                  position: relative;
                  text-align: center;
                  color: black;
                  background: #FFF;
                    height:120px;
                }
                .texte_centrer {
                  position: absolute;
                  top: 78%;
                  left: 50%;
                 
                  transform: translate(-50%, -50%);
                }
                
                
               

form-controlcon {
    display: block;
    width: 100%;
    height: calc(1.5em + .75rem + 2px);
    padding: .375rem .75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #495057;
    
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: .25rem;
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
}
                
                p {
                    display: block;
                    margin-block-start: 1em;
                    margin-block-end: 1em;
                    margin-inline-start: 0px;
                    margin-inline-end: 0px;
                    text-align: justify;
                    padding-left:10px;
                }
                
                .btn-info {
                    color: #fff;
                    background-color: #265ead;
                  {#  border-color: #eea236;#}
                    border: 1px solid #265ead;
                }

                
                /* Bouton de recherche*/
                
                * {
                        box-sizing: border-box;
                      }
                      
                      
                      .btndeconnect{
                            background-color: #e4a3a5;
                            border: 1px solid #dadce0;
                            -webkit-border-radius: 4px;
                            border-radius: 8px;
                            display: inline-block;
                            font: 500 16px/16px Google Sans,Roboto,RobotoDraft,Helvetica,Arial,sans-serif;
                            letter-spacing: .15px;
                            outline: 0;
                            color:white;
                            padding: 10px 24px;
                            text-align: center;
                            text-decoration: none;
                            white-space: normal;
                            float: right;
                            display:none;
                            font-weight:bold
                      }
                      .btndeconnect:hover {
                        color:white;
                      }
                      
                      .btnwhite:hover {
                        color:white;
                      }
                      
                      .btn-ems:hover{
                          color:white;
                      }
                      
                .input-form{
                        height: calc(1.5em + .75rem + 2px);
                        padding: .375rem .75rem;
                        font-size: 1rem;
                        font-weight: 400;
                        line-height: 1.5;
                        color: #495057;
                        background-color: #fff;
                        background-clip: padding-box;
                        border-radius: .25rem;
                        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
                        border: solid 2px #337ab7;
                        border-radius: .25rem;
                }
                      
                      
                      /* Style the search field */
                form.example input[type=text] {
                  padding: 5px;
                  font-size: 17px;
                  border: 1px solid grey;
                  float: left;
                  width: 80%;
{#                  background: #f1f1f1;#}
                }
                
                /* Style the submit button */
                form.example button {
                  float: left;
                  width: 20%;
                  height:30px;
                  border-radius: 8px;
                  padding: 5px;
                  background: #3a9ee2;
                  color: white;
                  font-size: 17px;
                  border: 1px solid grey;
                  border-left: none; /* Prevent double borders */
                  cursor: pointer;
                }
                
                form.example button:hover {
                    background: #0b7dda;
                  }
                  
                  /* Clear floats */
                    form.example::after {
                      content: "";
                      clear: both;
                      display: table;
                    }
              
                
                 /* Let's get this party started */
                ::-webkit-scrollbar {
                    width: 6px;
                }
                /* Track */
               ::-webkit-scrollbar-track {
                   -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3); 
                   -webkit-border-radius: 10px;
                   border-radius: 10px;
               }
                /* Handle */
               ::-webkit-scrollbar-thumb {
                    -webkit-border-radius: 10px;
                    border-radius: 10px;
                    background: #265ead; 
                    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5); 
               }
               ::-webkit-scrollbar-thumb:window-inactive {
                    background: rgba(255,0,0,0.4); 
               }
                
                
              
               
                #sidebar-wrapper {
                  min-height: 100vh;
                  margin-left: -15rem;
                  -webkit-transition: margin .25s ease-out;
                  -moz-transition: margin .25s ease-out;
                  -o-transition: margin .25s ease-out;
                  transition: margin .25s ease-out;
                  position: fixed;
                   margin-top: 25px;
                }
                
               {#New#}
                #sidebar-wrapper-connexion{
                    margin-top: 25px;
                    position: fixed;
                    min-height: 100vh;
                    margin-left: -70%;
                    width: 70%;
{#                    border-right: 3px #007bff solid;#}
                    
                }
                
                
                .scroll{
                    overflow-y: scroll;
                }

                #sidebar-wrapper .sidebar-heading {
                  padding: 0.875rem 1.25rem;
                  font-size: 1.2rem;
                }

                #sidebar-wrapper .list-group {
                  width: 15rem;
                }


                #page-content-wrapper {
                  min-width: 100vw;
                  margin-left: 10;
                   margin-top: 25px;
                }
                
                 #page-content-wrapper-connexion {
                  min-width: 100vw;
                  margin-left: 10;
                   margin-top: 25px;
                   padding:10px 10px;
                }
                
                

                #wrapper.toggled #sidebar-wrapper {
                  margin-left: 0;
                }
                
                .titre{
                    border-bottom: ridge 2px #337ab7;
                    background: #fff;
                    z-index: 100;
                    position: fixed; 
                    width:100%;
                    
                }
                
                 .content{
                     position: absolute;
                     width: 100%;
                     padding-bottom:50px;
                    {# top: 55px;#}
                     
                }
                
                 .head-search-list{
                   position: fixed;
                   z-index: 2045;
                   right: 0; 
                   top:55px;
                   {#border: solid 1px red;#}
                   border-bottom: ridge 2px #337ab7;
                   background: #FFF;
                   width: 100%
                }
                
                 .form-control{
                         border: solid 2px #337ab7;;
                        }
                        
                        .counter .counter-lg {
    top: 0px !important;
    position:absolute;
}
                        
                        .navbar{
                            display:block;
                        }
                        
                #cgDiv{
                    padding-left:20px;
                    padding-right:20px;
                    padding-top:60px;
                }

                @media only screen and  (min-width: 768px) {
                    
                     .counter .counter-lg {
                    top: 0px !important;
                    left:2px;
                    position:absolute;
                    }
                    
                    
                    #imgMobile{
                       display:none;
                    }
                    
                  
                    
                    #cgDiv{
                        padding-left:20%;
                        padding-right:20%;
                    }
                    
                     .navbar{
                            display:none;
                        }
                        .btndeconnect{
                            display:block;
                        }
                        
                  #sidebar-wrapper {
                    margin-left: 0;
                  }
                  
                    #sidebar-wrapper-connexion{
                    margin-left: 0;
                  }

                  #page-content-wrapper {
                    min-width: 0;
                    width: 100%;
                    margin-left: 15rem;
                  }
                  
                  #page-content-wrapper-connexion {
                        min-width: 0;
                        width: 100%;
                        margin-left: 70%; 
                  }
                  
                  
                  
                  
                  {#.titre{
                    width: calc(100% - 15rem);
                   }#}
                   
                
                   .content{
                    width: calc(100% - 15rem);
                   }
                   
                   .head-search-list{
                         width: calc(100% - 15rem);
                        }
                        
                        .width-input-field{
                         width: 50%;
                        }
                        
                        
                        


                }

                .border-bottom-primary {
                    border-bottom: 2px #265ead solid;
                 }


                .preview-bar {
                    height: 55px;
                }

                .py-2 {
                    padding-bottom: .5rem !important;
                }

                .py-2 {
                    padding-top: .5rem !important;
                }

                .fixed-top {
                    position: fixed;
                    top: 0;
                    right: 0;
                    {#left: 0;#}
                    z-index: 1030;
                  
                }
                
                .mt-4 {
                    color:#337ab7; 
                }
                

                .div-preview {
                    position: absolute;
                    height: calc(100% - 30px);
                    width: 100%;
                    border: none;
                    margin-top: 30px;
                     overflow-x:hidden;
                }

                
{#           Ajout de CSS#}
                .btn-ems{
                    background: #265ead;
                    color: white;
                    font-weight: bold;
                    font-size: 13px;
                    height: 30px;
                    border-radius: 8px;
                }
                
                .search-list{
                  {# margin-top: 10px;
                   margin-right: 40px;#}
                   width: 200px;
                }
                
               
                
                
{#                Filtrage des recherche#}

                .results tr[visible='false'],
.no-result{
  display:none;
}

.results tr[visible='true']{
  display:table-row;
}

.counter{
  padding:8px; 
  color:#ccc;
}








.searchTerm {

  border: 3px solid #3a9ee2;
 
  padding: 5px;
  height: 30px;
  border-radius: 5px 5px 5px 5px;
  outline: none;
  color: #9DBFAF;
}

.searchTerm:focus{
  color: #3a9ee2;
}





   /* The Modal (background) */
                    .modal {
                      display: none; /* Hidden by default */
                      position: fixed; /* Stay in place */
                      z-index: 100; /* Sit on top */
                      padding-top: 100px; /* Location of the box */
                      left: 0;
                      top: 0;
                      width: 100%; /* Full width */
                      height: 100%; /* Full height */
                      overflow: auto; /* Enable scroll if needed */
                      background-color: rgb(0,0,0); /* Fallback color */
                      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
                    }

                    /* Modal Content */
                    .modal-content {
                      background-color: #fefefe;
                      margin: auto;
                      padding: 0px 20px;
                      border: 1px solid #888;
                      width:500px;
                    }

                    /* The Close Button */
                    .close {
                      color: #aaaaaa;
                      float: right;
                      font-size: 28px;
                      font-weight: bold;
                    }

                    .close:hover,
                    .close:focus {
                      color: #000;
                      text-decoration: none;
                      cursor: pointer;
                    }
                    
                    
                    
                    
                    
{#                    Table responsive#}

table {
                     border-collapse: collapse;
                        width: 100%;
                        position:relative;
                }
                th, td{
                    padding: 10px;
                    text-align: left;
{#                    border: solid 1px #ccc;#}
                }
                th{
{#                    background-color: #000;#}
{#                    color: #FFF;#}
                }
                tr:nth-child(odd){
{#                    background-color: #eee;#}
                }
                
                .notification-jour{
                    padding-top: 415px;
                    width: 100%;
                    padding-left: 20px;
                    {#background: #FFF;#}
                    margin-top: -20px
                }
                
                #notification-bp{
                  width: 315px;
                  height: 30px;
                }
                
                .creation-mobile{
                   float: right;
                   visibility: hidden;
                }
                
                @media only screen and (max-width:767px){
                    #footerDesk{
                             display:none;
                   }
                   .contenant {
                        height: 178px;
                   }
                   
                   .texte_centrer {
                 
                  top: 62%;
                  
                }
                }
                
                 @media only screen and (max-width:768px){
                       
                        #notification-bp{
                         width: 100%;
                         }
                         
                           .openDoc{
                    visibility: hidden;
                    }
                         .notification-jour{
                             margin-top:460px;
                             background:red;
                         }
                         
                         .creation-mobile{
                             visibility:visible;
                         }
                       
        .table-responsive table,thead,tbody,tr,th,td{
            display: block;
          {#  overflow-x:hidden;#}
            word-break:break-word;
        }
        .table-responsive{
            top:20px;
        }
        
         .table-responsive table, td{
            width: 100%;
        }
        
        .table-responsive thead{
            display: none;
        }
         .show-thead th{
             display: none;
        }
        .table-responsive td:not(.action){
            padding-left: 150px;
            position: relative;
            margin-top: -1px;
            background: #FFF;  
        }
        
         .table-responsive .action{
           text-align:right;
        }   
        
        .table-responsive td:nth-child(odd){
{#            background-color: #eee;#}
        }
        
        .table-responsive td:not(.action)::before{
            padding: 10px;
            content: attr(data-label);
            position: absolute;
            top: 0;
            left: 0;
            width: 130px;
            bottom: 0;
            background-color: #000;
            color: #FFF;
            display: flex;
            align-items: center;
            font-weight: bold;
            
        }
        
        {#Place des fonctions
        td:nth-child(5){
             background: red;
        }
        td:nth-child(5)::before{
            background: red;
        }#}
            
        
       
        .table-responsive tr{
            margin-bottom: 1rem;
            
        }
    }

    
    
    
    body { background: #F5F5F5; font: 18px/1.5 sans-serif; }
    
    #wrapper-notification {  z-index: 2045;background: #FFF; margin: -27px 1em 2px; max-width: 100%; width: 95%; position:fixed;border-bottom: solid #3a9ee2}
    
    
    
    .ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active, a.ui-button:active, .ui-button:active, .ui-state-active.ui-button:hover 
{
  border: 1px solid #FFF;
  background: #3a9ee2;
}

            
            </style>
        
        
        
        {% endblock %}
        <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
    </head>
    <body>
        
        {% block body %}
            
        {% endblock %}
        
        
        {% block javascripts %}
                {% if(is_granted('ROLE_COFFRE')) %}  
                            <script src="{{ asset('WebSocketClient/client.js') }}"></script>
                {% endif %}
                
                
            <script>
                //Configuration WebSocket
                
                
                $(document).ready(function() {
                   
                    //alert(1);
                                       
                    $(".search").keyup(function () {
                        var searchTerm = $(".search").val();
                        var listItem = $('.results tbody').children('tr');
                        var searchSplit = searchTerm.replace(/ /g, "'):containsi('");
                        
                        $.extend($.expr[':'], {'containsi': function(elem, i, match, array){
                              return (elem.textContent || elem.innerText || '').toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
                          }
                        });

                        $(".results tbody tr").not(":containsi('" + searchSplit + "')").each(function(e){
                          $(this).attr('visible','false');
                        });

                        $(".results tbody tr:containsi('" + searchSplit + "')").each(function(e){
                          $(this).attr('visible','true');
                         
                          
                        });
                        
                         //$(".results tbody tr td").css("width", "100%");
                         //$(".results tbody tr td").css("max-width", "100%");
                        
                        //$(".results").css("width", "3000x");

                        var jobCount = $('.results tbody tr[visible="true"]').length;
                        $('.counter').text(jobCount + ' élément(s)');

                        if(jobCount == '0') {$('.no-result').show();}
                        else {$('.no-result').hide();}
                    
    });
                    
                    
                    /**
                     * Fonctionnalités de notification
                     */
                    
                      $( "#formnotificationsboite" ).submit(function( event ) {
                           
                            var bp=$('#notification-bp').val();
                            
                            if(bp==''){
                            $( "#notification-bp" ).addClass( "border border-danger" );
                            $("#info-notification").text('Entrez le numero d\'une boite');
                             event.preventDefault(); // avoid to execute the actual submit of the form.
                            } else if(!isInt(bp)){
                                 $( "#notification-bp" ).addClass( "border border-danger" );
                            $("#info-notification").text('Ce numéro de boîte postale n\'est pas valide');
                             event.preventDefault(); // avoid to execute the actual submit of the form.

                            }
                        
                      });
                   
                    $( ".notification-nature").submit(function( event ) {
                            event.preventDefault(); // avoid to execute the actual submit of the form.
                            var form = $(this);
                            var url = form.attr('action');
                            var data=form.serialize();
                            
                             //Deserialisation  data_table["pays"], data_table["typeenvoi"]
                            // data_table["poids"]
                            var form_data = data.split('&');
                            var data_table     = [];

                             $.each(form_data, function(key, value) {
                                 var data = value.split('=');
                                 data_table[data[0]] = data[1];
                             }); //Fin
                             //Decodage
                            var id=decodeURI(data_table["id"]);
                            var nature=decodeURI(data_table["nature"]);
                            
                            //Recuperation boite postale saisie
                            var bp=$('#notification-bp').val();
                            
                            if(bp==''){
                                $( "#notification-bp" ).addClass( "border border-danger" );
                                $("#info-notification").text('Entrez une boîte casier, SVP !');
                            } else if(!isInt(bp)){
                                $( "#notification-bp" ).addClass( "border border-danger" );
                                $("#info-notification").text('Boîte casier invalide !');
                            }else{
                                          
                                    $.ajax({
                                            url:url,
                                            data:{
                                                "id":id,
                                                "nature":nature,
                                                "boitecasier":bp
                                            },
                                            success: function(response){
                                                {#alert(response.autorise);
                                                alert(response.message);#}
                                                  if(response.autorise=='oui'){
                                                      location.reload(); 
                                                  }else{
                                                     $( "#notification-bp" ).addClass( "border border-danger" );
                                                     $("#info-notification").text('Notification non autorisée !'); 
                                                  }                    
                      
                                            },
                                            error: function (request, status, error) {
                                                alert(request.responseText);
                                            }
                                    });
                            }
                        
                      });
                      
                      
                      
                        $( "#form_pwdrappel" ).submit(function( event ) {
                           event.preventDefault(); // avoid to execute the actual submit of the form.
                           //alert(8);
                            var form = $(this);
                            var url = form.attr('action');
                             var email =$.trim($('#chercher_email').val()); 
                             //alert(8);
                              var action ='@cruser$ab'; 
                               $('#loadingsearch').show();
                             $.ajax({
                                            url:url,
                                            data:{
                                                "email":email,
                                                "action":action,
                                            },
                                            success: function(response){
                                                //alert(response.message);
                                                 $('#loadingsearch').hide();
                                                if(response.message=='oui'){
                                                    $( "#succesdivrappelpwd" ).css({'display':'block'});
                                                    $( "#faildivrappelpwd" ).css({'display':'none'});
                                                }
                                                else{
                                                    $( "#faildivrappelpwd" ).css({'display':'block'});
                                                    $( "#succesdivrappelpwd" ).css({'display':'none'});
                                                } 
                                            },
                                            error: function (request, status, error) {
                                                alert(request.responseText);
                                            }
                                        });
                        
                        });
                        
                        
                        //Changement Mot de Passe
                        $('body').on("blur",'#currentPWD', function(){
                            var currentPWD =$(this).val(); 
                            //Pour le Controle d'Execution
                            var action ='@cruser$ab'; 
                            var url =  '{{ path('password_find') }}';
                             
                            
                            if(currentPWD.length!=0){
                                    //alert(url);
                                    $.ajax({
                                            url:url,
                                            data:{
                                                "currentPWD":currentPWD,
                                                "action":action
                                            },
                                            success: function(response){
                                                if(response.message=='oui'){
                                                   //ici
                                                    $("#currentPWD").removeClass("border border-danger" );
                                                    $('#errorcurrentPWD').hide();
                                                }else{
                                                    //ici
                                                     $('#errorcurrentPWD').show();
                                                     $("#currentPWD").addClass( "border border-danger" );
                                                }                    
                      
                                            },
                                            error: function (request, status, error) {
                                                alert(request.responseText);
                                            }
                                    });
                            }
                        });
                        
                        $('body').on("keyup",'#currentPWD', function(){
                            var currentPWD =$(this).val(); 
                            //if(currentPWD.length==0){
                                $('#errorcurrentPWD').hide();
                                $("#currentPWD").removeClass("border border-danger" );
                            //}
                        });
                
                        
                        $('body').on("keyup",'#firstPWD', function(e){
                            var pwd =$(this).val();
                            $('#errorfirstPWD').hide();
                            //alert(id);
                            if(pwd.match(/[a-z]/g) && pwd.match(/[A-Z]/g) && pwd.match(/[0-9]/g) && pwd.length >= 6) {
                              $(this).removeClass("border border-danger"); 
                             
                            }else if(pwd.length == 0){
                                 $(this).removeClass("border border-danger");
                                
                             }else{
                                $(this).addClass("border border-danger");  
                             }
                            
                            $('#secondPWD').removeClass("border border-danger");
                            $('#secondPWD').attr('disabled', true);
                            $('#secondPWD').val('');
                            $('#errorsecondPWD').hide();
                            
                             //Quand user tape entrer su le input
                            if(e.keyCode==13 && !$.isValidPassWordChange() && pwd.length!=0){
                                $('#errorfirstPWD').show();  
                            }
                           
                        });  
                        
                                                
                        $('body').on("blur",'#firstPWD', function(){
                            var firstPWD =$(this).val(); 
                            if(firstPWD.length!=0){
                                //$(input).prop(disabled, false);
                                if(firstPWD.match(/[a-z]/g) && firstPWD.match(/[A-Z]/g) && firstPWD.match(/[0-9]/g) && firstPWD.length >= 6) {
                                    $('#secondPWD').attr('disabled', false);
                                }else{
                                    $('#errorfirstPWD').show();
                                    $('#secondPWD').attr('disabled', true);
                                }
                            
                            }else{
                                $('#errorfirstPWD').hide()
                                $('#secondPWD').attr('disabled', true);
                                $('#secondPWD').val('');
                            }
                            
                            
                        });
                        
                        //Arret
                        $('body').on("keyup",'#secondPWD', function(){
                            var secondPWD =$(this).val();
                            var firstPWD =$('#firstPWD').val();
                            
                            if(secondPWD.length!=0 && firstPWD!=secondPWD){
                               $('#errorsecondPWD').show();
                               $(this).addClass("border border-danger");
                            }else{
                                 $('#errorsecondPWD').hide();
                                 $(this).removeClass("border border-danger");
                            }   
                            
                        });  
                        
                         $('body').on("cut copy paste",'.crf-pwd', function(e){
                                    e.preventDefault();
                         });
                         
                          $('body').on("focus",'.crf-pwd', function(e){
                                    $('#success-alert').hide();
                         });
                        
                        //--------
                        $( "#form_pwdchange" ).submit(function(event) {
                            event.preventDefault(); // avoid to execute the actual submit of the form.
                            var form = $(this);
                            var url = form.attr('action');
                            var currentPWD = $('#currentPWD').val(); 
                            if(currentPWD==''){return false;}
                            
                            var firstPWD = $('#firstPWD').val();
                            if(firstPWD==''){return false;}
                             
                            var secondPWD = $('#secondPWD').val(); 
                            if(secondPWD==''){return false;}
                            
                            if(firstPWD!=secondPWD){return false;}
                            var action ='@cruser$ab'; 
                            
                          
                          //alert(7);
                          
                               
                               
                             $.ajax({
                                            url:url,
                                            data:{
                                                "currentPWD":currentPWD,
                                                "firstPWD":firstPWD,
                                                "secondPWD":secondPWD,
                                                "action":action,
                                            },
                                            success: function(response){
                                                // alert(response.message);
                                                if(response.message==2){
                                                    //ici
                                                    $('#currentPWD').val('');
                                                    $('#firstPWD').val('');
                                                    $('#secondPWD').val(''); 
                                                    $('#secondPWD').attr('disabled', true);
                                                    
                                                    //$('#success-alert').addClass("alert alert-success");
                                                    $('#success-alert').show();
                                                }
                                            },
                                            error: function (request, status, error) {
                                                alert(request.responseText);
                                            }
                                        });
                        
                        });
                        
                                     
                     
                       
                    //saisie nom et prenom
                    $('body').on("keyup",'.ltc-nom', function(e){ 
                        if(e.keyCode!=13){
                           $(this).removeClass( "border border-danger" );
                           $('#errorname').hide();
                            $('#erroradresse').hide();  
                        }
                    });
                    
                     //saisie nom et prenom
                    $('body').on("keyup",'.reference', function(e){ 
                        if(e.keyCode!=13){
                            $(this).removeClass( "border border-danger" );
                            $('#errorRefNull').hide();
                            $('#errorRefAttr').hide();  
                        }
                    });
                    
                    
                    
                      $('body').on("keypress paste",'.ltc-nom', function(event){ 
                          if(event.keyCode!=13){
                              //$('input').on('keypress', function (event) {
                                var regex = new RegExp("^[a-zA-Z0-9 ]+$");
                                var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                                if (!regex.test(key)) {
                                   event.preventDefault();
                                   return false;
                                }
                          }
                    
                    });
                    
                    $('body').on("keypress paste",'.reference', function(event){ 
                          if(event.keyCode!=13){
                              //$('input').on('keypress', function (event) {
                                var regex = new RegExp("^[a-zA-Z0-9 ./-]+$");
                                var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                                if (!regex.test(key)) {
                                   event.preventDefault();
                                   return false;
                                }
                          }
                    
                    });
                    
                     $('body').on("keypress paste",'#appbundle_user_email', function(e){
                        //var reg = /^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i;
                        var regex = new RegExp("^[a-zA-Z0-9._%+-@]+$");
                        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                        if (!regex.test(key)) {
                           event.preventDefault();
                           return false;
                        }
                    });
                    
                      $('body').on("keypress",'#appbundle_utilisateur_telephone', function(event){ 
                    //$('input').on('keypress', function (event) {
                        var regex = new RegExp("^[0-9]+$");
                        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                        if (!regex.test(key)) {
                           event.preventDefault();
                           return false;
                        }
                    });
                    
                     $('body').on("keypress paste",'.float-price', function(event){ 
                    //$('input').on('keypress', function (event) {
                        if(event.keyCode!=13){
                            var regex = new RegExp("^[0-9.]+$");
                            var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                            if (!regex.test(key)) {
                               event.preventDefault();
                               return false;
                            }
                        }
                    });
                    
                    $('body').on("keypress paste",'.telephone', function(event){ 
                    //$('input').on('keypress', function (event) {
                     if(event.keyCode!=13){
                            var regex = new RegExp("^[0-9]+$");
                            var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                            if (!regex.test(key)) {
                               event.preventDefault();
                               return false;
                            }
                        }
                    });
                    $('body').on("keyup",'.telephone', function(e){ 
                            if(e.keyCode!=13){
                                $('#errorphone').hide();  
                            }
                    });
                    
                    //Controle saisie telephone user
                      $('body').on("keyup",'#appbundle_utilisateur_telephone', function(e){ 
                            $('#errorphone').hide();
                            var telephone = $.trim($('#appbundle_utilisateur_telephone').val());
                            if($.isNumeric(telephone)){
                              if (telephone.indexOf(".") >= 0){
                                   //float
                                   //alert('float');
                                   $("#appbundle_utilisateur_telephone").addClass( "border border-danger" );
                                } else{
                                   //int
                                    //alert('int');
                                    if(telephone.length<5){
                                        $("#appbundle_utilisateur_telephone").addClass( "border border-danger" );
                                    }else{
                                         $("#appbundle_utilisateur_telephone").removeClass( "border border-danger" );
                                    }
                                }
                            } else{
                                //not a number
                                // alert('not a number');
                                if(telephone.length==0){
                                    $("#appbundle_utilisateur_telephone").removeClass( "border border-danger" );
                                }else{
                                    $("#appbundle_utilisateur_telephone").addClass( "border border-danger" );
                                }
                                
                            }
                            //Quand user tape entrer su le input
                            if(e.keyCode==13 && !$.isValidPhone() && telephone.length!=0){
                               $('#errorphone').show();  
                            }
                    });
                    
                    $('body').on("blur",'#appbundle_utilisateur_telephone', function(){
                       var telephone = $.trim($('#appbundle_utilisateur_telephone').val());
                            if($.isNumeric(telephone)){
                              if (telephone.indexOf(".") >= 0){
                                   //float
                                   $('#errorphone').show();
                                }
                            } else{
                                //not number
                                if(telephone.length>0){
                                      $('#errorphone').show();
                                }  
                            }
                            if(telephone.length<5 && telephone.length!=0){ $('#errorphone').show();}
                    });
                    
                    //Controle email user
                   {# $('body').on("blur",'#appbundle_user_email', function(){
                        $('#erroremail').show();
                    });#}
                    
                    $('body').on("blur",'#appbundle_user_email', function(){
                            var email =$(this).val(); 
                            //Pour le Controle d'Execution
                            var action ='@cruser$ab'; 
                            var url =  '{{ path('email_find') }}';
                             
                           
                            if(email.length!=0){
                                    //alert(url);
                                     //alert(334);
                                    if(!validateEmail(email)) {
                                        $("#appbundle_user_email").addClass( "border border-danger" );
                                        $('#erroremailValidation').show();          
                                        return false;
                                    } 
                                       
                                    $.ajax({
                                            url:url,
                                            data:{
                                                "email":email,
                                                "action":action
                                            },
                                            success: function(response){
                                                if(response.message=='oui'){
                                                   //ici
                                                    $('#erroremail').show();
                                                    $("#appbundle_user_email").addClass( "border border-danger" );
                                                }else{
                                                    //ici
                                                    $("#appbundle_user_email").removeClass("border border-danger" );
                                                    $('#erroremail').hide();
                                                }                    
                      
                                            },
                                            error: function (request, status, error) {
                                                alert(request.responseText);
                                            }
                                    });
                            }
                        });
                    
                    $('body').on("keyup",'#appbundle_user_email', function(e){
                        if(e.keyCode!=13){
                            $('#erroremail').hide();
                            $('#erroremailValidation').hide();
                            $('#erroremailExist').hide();
                            $("#appbundle_user_email").removeClass("border border-danger" );
                        }
                        
                    });
                    
                    
                                  //Controle saisie mot de passe    
                    $('body').on("keyup",'#appbundle_user_password', function(e){
                            var pwd =$(this).val();
                            $('#errorpwd').hide();
                            //alert(id);
                            if(pwd.match(/[a-z]/g) && pwd.match(/[A-Z]/g) && pwd.match(/[0-9]/g) && pwd.length >= 6) {
                              $(this).removeClass("border border-danger"); 
                            }else if(pwd.length == 0){
                                 $(this).removeClass("border border-danger");
                             }else{
                                $(this).addClass("border border-danger");  
                             }
                            
                            $('#appbundle_user_passwordconfirm').removeClass("border border-danger");
                            $('#appbundle_user_passwordconfirm').attr('disabled', true);
                            $('#appbundle_user_passwordconfirm').val('');
                            $('#errorpwdconfirm').hide();
                            
                            //Quand user tape entrer su le input
                            if(e.keyCode==13 && !$.isValidPassWord() && pwd.length!=0){
                               $('#errorpwd').show();  
                            }
                           
                        });  
                        
                        $('body').on("blur",'#appbundle_user_password', function(){
                            var firstPWD =$(this).val(); 
                            if(firstPWD.length!=0){
                                //$(input).prop(disabled, false);
                                if(firstPWD.match(/[a-z]/g) && firstPWD.match(/[A-Z]/g) && firstPWD.match(/[0-9]/g) && firstPWD.length >= 6) {
                                    $('#appbundle_user_passwordconfirm').attr('disabled', false);
                                }else{
                                    $('#errorpwd').show();
                                    $('#appbundle_user_passwordconfirm').attr('disabled', true);
                                }
                            
                            }else{
                                $('#errorpwd').hide()
                                $('#appbundle_user_passwordconfirm').attr('disabled', true);
                                $('#appbundle_user_passwordconfirm').val('');
                            }
                            
                            
                        });
                        
                        $('body').on("keyup",'#appbundle_user_passwordconfirm', function(){
                            var secondPWD =$(this).val();
                            var firstPWD =$('#appbundle_user_password').val();
                            
                            if(secondPWD.length!=0 && firstPWD!=secondPWD){
                               $('#errorpwdconfirm').show();
                               $(this).addClass("border border-danger");
                            }else{
                                 $('#errorpwdconfirm').hide();
                                 $(this).removeClass("border border-danger");
                            }   
                            
                        });  
                    
                    
                   {# $('body').on("focus click keyup",'#appbundle_user_password', function(e){
                        if(e.keyCode!=13){
                             $('#errorpwd').hide();
                        }
                    });#}
                    
                   
                    
                   
                    
                    $.isValidPassWord = function() 
                    { 
                        var password = $('#appbundle_user_password').val();
                        if(password.match(/[a-z]/g) && password.match(/[A-Z]/g) && password.match(/[0-9]/g) && password.length >= 6) {
                            return true;
                        }else{
                           return false;
                        }
                      
                    };
                    
                    $.isValidPassWordChange = function() 
                    { 
                        var password = $('#firstPWD').val();
                        if(password.match(/[a-z]/g) && password.match(/[A-Z]/g) && password.match(/[0-9]/g) && password.length >= 6) {
                            return true;
                        }else{
                           return false;
                        }
                      
                    };
                    
                    $.isValidPhone = function() 
                    {
                            var telephone = $.trim($('#appbundle_utilisateur_telephone').val());
                            if($.isNumeric(telephone)){
                              if (telephone.indexOf(".") >= 0){
                                   //float
                                   return false;
                                }
                            } else{
                                //not number
                                if(telephone.length>0){
                                     return false;;
                                }  
                            }
                            
                            if(telephone.length<5){return false;}
                            return true;
                    };
                    
                    
                    
                     $('body').on("click",'#useannuller', function(){
                       //alert(6666);
                        $('#appbundle_utilisateur_prenom').val('');
                        $('#appbundle_utilisateur_nom').val('');
                        
                        $('#appbundle_user_email').val(''); 
                        $('#appbundle_utilisateur_telephone').val(''); 
                        $('#appbundle_user_password').val(''); 
                        $('#appbundle_user_passwordconfirm').val('');
                        
                        $('#appbundle_user_email').removeClass("border border-danger");
                        $('#appbundle_utilisateur_telephone').removeClass("border border-danger");
                        $('#appbundle_user_password').removeClass("border border-danger");
                        $('#appbundle_user_passwordconfirm').removeClass("border border-danger");
                        
                        $('#errorphone').hide();
                        $('#erroremail').hide();
                        $('#errorpwd').hide();
                        $('#errorpwdconfirm').hide();
                        
                        
                        
                        
                        $('#appbundle_user_passwordconfirm').attr('disabled', true);

                       
                    });
                    
                    
                    $('body').on("keyup",'.email-input', function(e){
                            var email =$(this).val();
                            //Quand user tape entrer su le input
                            if(e.keyCode!=13  && email.length!=0){
                                $('#errorused').hide();
                                $('#errorfound').hide();
                                $('#errorinvalid').hide();
                            }
                           
                        });  
                        
                    $( ".form_submitupdate" ).submit(function( event ) {
                            event.preventDefault(); // avoid to execute the actual submit of the form.
                            $('#loadingsearch').show();
                            event.currentTarget.submit();        
                    });
                    
                    $( ".form_submit" ).submit(function( event ) {
                            event.preventDefault(); // avoid to execute the actual submit of the form.
                            var email = $(this).find('input[name="email"]').val();
                            //var nom = $.trim($(".ltc-nom").val());
                            var nom = $.trim($(this).find('.nom').val());
                            var telephone = $(this).find('input[name="telephone"]').val();
                            var adresse = $.trim($(this).find('input[name="adresse"]').val());
                            //alert(3)
                            //Affichage erreurs
                            if(!validateEmail(email)) {  
                                $('#errorinvalid').show();                    
                            } 
                            if(nom==''){  $('#errorname').show(); } 
                            if(adresse==''){  $('#erroradresse').show(); } 
                             
                            if(!ValidPhone(telephone)) {  
                                $('#errorphone').show();                    
                            } 
                            
                            //Arret apres erreurs
                            if(!validateEmail(email)) {
                                return false;       
                            } 
                            if(nom==''){ return false; }
                            if(adresse==''){ return false; }
                            if(!ValidPhone(telephone)) {  
                                return false;                   
                            } 
                            
                            var action ='@cruser$ab'; 
                            var url =  '{{ path('email_find_state') }}';
                            
                            $('#loadingsearch').show();
                            $(this).find(':submit').attr('disabled','disabled');
                            
                            $.ajax({
                                    url:url,
                                    data:{
                                        "email":email,
                                        "action":action,
                                    },
                                    success: function(response){
                                      
                                       // $('#loadingsearch').hide();
                                        if(response.message==1){
                                            $('#errorused').show();
                                             $('#loadingsearch').hide();
                                        }else if(response.message==2){
                                            $('#errorfound').show();  
                                             $('#loadingsearch').hide();
                                        }else{
                                            event.currentTarget.submit();
                                        }
                                        //$('.submit-button').removeAttr('disabled');
                                      
                                    },
                                    error: function (request, status, error) {
                                        //alert(4444);
                                        $('#loadingsearch').hide();
                                    }
                            });
                            
                            //alert(email);
                     });
                     
                     
                     $( ".formControlValidClient" ).submit(function( event ) {
                            event.preventDefault(); // avoid to execute the actual submit of the form.
                            var email = $(this).find('input[name="email"]').val();
                            //var nom = $.trim($(".ltc-nom").val());
                            var nom = $.trim($(this).find('.nom').val());
                            var telephone = $(this).find('input[name="telephone"]').val();
                            var adresse = $.trim($(this).find('input[name="adresse"]').val());
                            //alert(3)
                            //Affichage erreurs
                            if(!validateEmail(email)) {  
                                $('#errorinvalid').show();                    
                            } 
                            if(nom==''){  $('#errorname').show(); } 
                            if(adresse==''){  $('#erroradresse').show(); } 
                             
                            if(!ValidPhone(telephone)) {  
                                $('#errorphone').show();                    
                            } 
                            
                            //Arret apres erreurs
                            if(!validateEmail(email)) {
                                return false;       
                            } 
                            if(nom==''){ return false; }
                            if(adresse==''){ return false; }
                            if(!ValidPhone(telephone)) {  
                                return false;                   
                            } 
                            
                            var action ='@cruser$ab'; 
                            var url =  '{{ path('email_find_state') }}';
                            
                            $('#loadingsearch').show();
                            $(this).find(':submit').attr('disabled','disabled');
                            
                            
                            
                            $.ajax({
                                    url:url,
                                    data:{
                                        "email":email,
                                        "action":action,
                                    },
                                    success: function(response){
                                      
                                       // $('#loadingsearch').hide();
                                        if(response.message==1){
                                            $('#errorused').show();
                                             $('#loadingsearch').hide();
                                        }else if(response.message==2){
                                            $('#errorfound').show();  
                                             $('#loadingsearch').hide();
                                        }else{
                                            //event.currentTarget.submit();
                                            alert('cest bien' );
                                        }
                                        //$('.submit-button').removeAttr('disabled');
                                      
                                    },
                                    error: function (request, status, error) {
                                        //alert(4444);
                                        $('#loadingsearch').hide();
                                    }
                            });
                            
                            //alert(email);
                     });

                      
                      $( "#form_user" ).submit(function( event ) {
                            event.preventDefault(); // avoid to execute the actual submit of the form.  
                            
                            var form = $(this);
                            var url =  '{{ path('user_new') }}';
                            //var data=form.serialize();
                            var action ='@cruser$ab'; 
                            
                            var categ=$.trim($('input[name=civilite-categ]:radio').val());
                            var civilite =$.trim($('#appbundle_utilisateur_civilite').val()); 
                            var prenom=$.trim($('#appbundle_utilisateur_prenom').val());
                            var nom =$.trim($('#appbundle_utilisateur_nom').val());
                            var email =$.trim($('#appbundle_user_email').val()); 
                           {# var password =$('#appbundle_user_password').val(); 
                            var confirm =$('#appbundle_user_passwordconfirm').val(); #}
                            var telephone=$.trim($('#appbundle_utilisateur_telephone').val());

                            if(nom==''){
                                  $( "#appbundle_utilisateur_nom" ).addClass( "border border-danger" );
                              }
                            if(prenom==''){
                                 $( "#appbundle_utilisateur_prenom" ).addClass( "border border-danger" );
                             }

                            if ($("#civilite-categ-pa").is(":checked")) {
                                categ=$.trim($("#civilite-categ-pa").val());
                                    if(prenom==''){
                                        return false;
                                    }
                                }
                                else if ($("#civilite-categ-et").is(":checked")) {
                                categ=$.trim($("#civilite-categ-et").val());
                                }
                                else if ($("#civilite-categ-pl").is(":checked")) {
                                categ=$.trim($("#civilite-categ-pl").val());
                            }
                            
                                                     
                            //alert($.isValidPassWord());
                                                        
                            if(nom==''){
                                return false;
                            }
                             
                            if(!$.isValidPhone()){
                               //alert(33);  
                               return false;
                             }
                             
                            if(!validateEmail(email)) {
                                        $("#appbundle_user_email").addClass( "border border-danger" );
                                        $('#erroremailValidation').show(); 
                                        //alert(1);
                                        return false;
                            } 
                             
                           {# if(!$.isValidPassWord()){
                               //alert(33);  
                               return false;
                             }
                             
                             if(password!=confirm){
                              // alert(113);  
                               return false;
                             }#}
                            
                           //Apres soumisssion si tout est ok, on empeche double soumission
                            $(this).find(':submit').attr('disabled','disabled');
                            
                             if($("#civilite-categ-pa").is(":checked")){                 
                                      //Ajax loader Show
                                      //alert(1)
                                       $('#loadingmessage').show();
                                        $.ajax({
                                            url:url,
                                            data:{
                                                "categ":categ,
                                                "civilite":civilite,
                                                "prenom":prenom,
                                                "nom":nom,
                                                "email":email,
                                                "telephone":telephone,
                                                "action":action,
                                            },
                                            success: function(response){
                                               // alert(response.message);
                                                //$(this).find(':submit').removeAttr('disabled');
                                                $('.submit-button').removeAttr('disabled');
                                                $('#loadingmessage').hide();
                                               //alert(response.message);
                                                if(response.message=='Creation'){
                                                    $('#success-user').html("<p>Le coffre est créé avec succès. Le mot de passe du propriétaire lui sera notifié par \n\
                                                         <br/> <b>e-mail : </b> <span style='color:red;font-weight:bold'>"+response.email+"</span>.<br/><span>\n\
                                                         <a href=\"#\" id=\"deleteDialogCreateUser\" class=\"btn btn-ems r-ems\">OK</a></span></p>"
                                                        );
                                                    $( "#success-user" ).css({'display':'block'});
                                                    $( "#myModal" ).css({'display':'none'});
                                                    
                                                    $('#appbundle_utilisateur_prenom').val('');
                                                    $('#appbundle_utilisateur_nom').val('');
                                                    $('#appbundle_user_email').val(''); 
                                                    $('#appbundle_utilisateur_telephone').val(''); 
                                                    //Requ3ete Ajax Communication Mot de Passe
                                                    //alert(3);
                                                    var urlSendMail='{{ path('user_sendMailUserCreated') }}';
                                                    $.ajax({
                                                        url:urlSendMail,
                                                        data:{
                                                            "civilite":response.civilite,
                                                            "nom":response.nom,
                                                            "email":response.email,
                                                            "password":response.password,
                                                            "action":action,
                                                        },
                                                        success: function(response){
                                                            //console.log('yes')
                                                        }    
                                                    });
                                                                                
                                                }else if(response.message=='EmailNoExist'){
                                                   // $('#success-user').html("<p>Cet e-mail(<span style='color:red;font-weight: bold'>"+response.email+"</span>) " +"est déjà utilisé. Veuillez choisir une autre adresse .</p>");
                                                   // $( "#success-user" ).css({'display':'block'});
                                                    $( "#appbundle_user_email" ).addClass( "border border-danger" ); 
                                                    $('#erroremailExist').html('Cet e-mail n\'existe pas.');
                                                    $('#erroremailExist').show();
                                                }else{
                                                    $( "#appbundle_user_email" ).addClass( "border border-danger" ); 
                                                    $('#erroremailExist').html('Un compte lié à cet e-mail existe déjà.');
                                                    $('#erroremailExist').show(); 
                                                } 
                                            },
                                            error: function (request, status, error) {
                                                $('.submit-button').removeAttr('disabled');
                                                alert(request.responseText);
                                            }
                                        });
                                 
                             }else{
                                       //Ajax loader Show
                                       //alert(2)
                                       $('#loadingmessage').show();
                                       
                                      $.ajax({
                                            url:url,
                                            data:{
                                                "categ":categ,
                                                "civilite":civilite,
                                                "prenom":prenom,
                                                "nom":nom,
                                                "email":email,
                                                "telephone":telephone,
                                                "action":action,
                                            },
                                            success: function(response){
                                                 $('.submit-button').removeAttr('disabled');
                                                 $('#loadingmessage').hide();
                                               // alert(response.message);
                                                if(response.message=='Creation'){
                                                     $('#success-user').html("<p>Le coffre est créé avec succès. Le mot de passe du propriétaire lui sera notifié par \n\
                                                         <br/> <b>e-mail : </b> <span style='color:red;font-weight:bold'>"+response.email+"</span>.<br/><span>\n\
                                                         <a href=\"#\" id=\"deleteDialogCreateUser\" class=\"btn btn-ems r-ems\">OK</a></span></p>"
                                                        );

                                                    $( "#success-user" ).css({'display':'block'});
                                                    $( "#myModal" ).css({'display':'none'});
                                                    
                                                    $('#appbundle_utilisateur_prenom').val('');
                                                    $('#appbundle_utilisateur_nom').val('');
                                                    $('#appbundle_user_email').val(''); 
                                                    $('#appbundle_utilisateur_telephone').val(''); 
                                                    //Requ3ete Ajax Communication Mot de Passe
                                                    
                                                    var urlSendMail='{{ path('user_sendMailUserCreated') }}';
                                                    $.ajax({
                                                        url:urlSendMail,
                                                        data:{
                                                            "civilite":response.civilite,
                                                            "nom":response.nom,
                                                            "email":response.email,
                                                            "password":response.password,
                                                            "action":action,
                                                        },
                                                        success: function(response){
                                                            //console.log('yes')
                                                        }    
                                                    });
                                                    
                                                }else if(response.message=='EmailNoExist'){
                                                   // $('#success-user').html("<p>Cet e-mail(<span style='color:red;font-weight: bold'>"+response.email+"</span>) " +"est déjà utilisé. Veuillez choisir une autre adresse .</p>");
                                                   // $( "#success-user" ).css({'display':'block'});
                                                    $( "#appbundle_user_email" ).addClass( "border border-danger" ); 
                                                    $('#erroremailExist').html('Cet e-mail n\'existe pas.');
                                                    $('#erroremailExist').show();
                                                }else{
                                                    $( "#appbundle_user_email" ).addClass( "border border-danger" ); 
                                                    $('#erroremailExist').html('Un compte lié à cet e-mail existe déjà.');
                                                    $('#erroremailExist').show(); 
                                                } 
                                            },
                                            error: function (request, status, error) {
                                                $('.submit-button').removeAttr('disabled');
                                                alert(request.responseText);
                                            }
                                        });
                                  
                             }
                             //alert(555);
                             
                            
                             
                        });
                        
                        
                         $(".close-success-user").click(function(){
                              $( "#success-user" ).css({'display':'none'});
                              $( "#danger-user" ).css({'display':'none'});
                         });
                         
                         $('body').on("click",'#deleteDialogCreateUser', function(){
                              $( "#success-user" ).css({'display':'none'});
                         });
                      
                     $("#notification-bp").keyup(function(){
                       //Vidange infos call back
                       $('#info-notification').empty();
                       //Suppression de classes
                       $( "#notification-bp" ).removeClass( "border border-danger" );
                      
                     });
                     
                      {#$("input").keyup(function(e){
                       //Vidange infos call back
                      // $('#info-notification').empty();
                       //Suppression de classes
                       if(e.keyCode!=13){
                           $(this).removeClass( "border border-danger" );
                       }
           
                      
                     });#}
                   
                   //Dépôt de courriers
                    $("#depot-courrier").click(function(){
                        
{#                        var url = '{{ path('notification_new') }}';#}
                        var url = '{{ path('login') }}';
                        var bp=$('#notification-bp').val();
                        var notification="1";
                        var libnotification="Dépot de courrier(s)";
                        
                        //alert(isInt(bp));
                        if(!isInt(bp)){
                            $( "#notification-bp" ).addClass( "border border-danger" );
                            $("#info-notification").text('Ce numéro de boîte postale n\'est pas valide')
                        }else{
                            
                            $.ajax({
                            url:url,
                            data:{
                                "bp":bp,
                                "notification":notification,
                                "libnotification":libnotification
                            },
                            success: function(response){
                                alert(response.autorise);
                                alert(response.message);
                            },
                            error: function (request, status, error) {
                                alert(request.responseText);
                            }
                        });
                        
                        }
                        
                        
                        
                    });
                    
                     //Rappel mot de passe
                    $("#btnrappelpwd").click(function(){
                       
                        $( "#divrappelpwd" ).css({'display':'block'});
                        $( "#danger-user" ).css({'display':'none'});
                        
                        $( "#succesdivrappelpwd" ).css({'display':'none'});
                        $( "#faildivrappelpwd" ).css({'display':'none'});
                        $( "#success-user" ).css({'display':'none'});

                        
                    });
                    
                     //Modal Click Bouton
                    $(".myBtn").click(function(){
                       
                        $( "#myModal" ).css({'display':'block'});
                        $( "#divrappelpwd" ).css({'display':'none'});                   
                    });
                    
                    $(".close").click(function(){
                         $( "#myModal" ).css({'display':'none'});
                    });
                    
                    //Annulation Process Rappel PWD
                     $("#btnannulationrappelpwd").click(function(){
                        
                        $( "#divrappelpwd" ).css({'display':'none'});
                        
                        $('#form_pwdrappel').find('input[type=email]').each(function(){
                         $(this).val('');

                            });
                        
                    });
                    
                    
                    //Courrier volumineux
                    $("#courrier-volume").click(function(){
                          var bp=$('#notification-bp').val();
                        //alert('courrier-volume');
                        
                        
                    });

                    //Saturation BP
                    $("#saturation-bp").click(function(){
                        
                          var bp=$('#notification-bp').val();
                        //alert('saturation-bp');
                        
                    });

                    //Transfert au rebut
                    $("#transfert-rebut").click(function(){
                          var bp=$('#notification-bp').val();
                       // alert('transfert-rebut');
                        
                    });
                    
                    
                    
                    $(".btn-note").hover(function(){
                      $(this).css("border", "solid red");
                      }, function(){
                      $(this).css("border", "");
                    });

         
         //Inscription utilisateur
           $("input[name=civilite-categ]:radio").click(function() {
                if ($("#civilite-categ-pa").is(":checked")) {
                    $('.person-donnee').show(); 
                    $('#appbundle_utilisateur_prenom').attr("required", true);
                    $("#appbundle_utilisateur_nom").attr("placeholder", "Nom de famille");
                }
                else if ($("#civilite-categ-et").is(":checked")) {
                    $('.person-donnee').hide();
                    $('#appbundle_utilisateur_prenom').attr("required", false);
                    $("#appbundle_utilisateur_nom").attr("placeholder", "Nom ou raison sociale");
                }
                 else if ($("#civilite-categ-pl").is(":checked")) {
                    $('.person-donnee').hide();
                    $('#appbundle_utilisateur_prenom').attr("required", false);
                    $("#appbundle_utilisateur_nom").attr("placeholder", "Nom ou raison sociale");
                }  
            });        
   
    
    
     // Update Prix Unitaire Service
                    $(".cliupdatePU").click(function(){    
                        $(".updatePU").hide();
                        $(this).next().show();
                    });
                    
                    //AutreService
                    $( ".servicevendu" ).change(function() {
                        var str = "";
                        $( ".servicevendu option:selected" ).each(function() {
                          str += $( this ).text();
                        });
                        
                        if(str=='Autres documents'){
                           $('#divAutServ').show();
                        }else{
                            $('#divAutServ').hide(); 
                        }
                      
                      });
                      
    // Affichage Mot de Passe
    
                    $("#affichePWD").click(function(){    
                       if($(this).is(':checked')){
                        $('#password').attr('type', 'text');
                        $('#currentPWD').attr('type', 'text');
                        $('#firstPWD').attr('type', 'text');
                        $('#secondPWD').attr('type', 'text'); 
                          
                       }else{
                          $('#password').attr('type', 'password');
                          $('#currentPWD').attr('type', 'password');
                        $('#firstPWD').attr('type', 'password');
                        $('#secondPWD').attr('type', 'password');
                       }
                    });
            //Contole des NavBar
             $(document).click(function (event) {
                var clickover = $(event.target);
                var _opened = $(".navbar-collapse").hasClass("show");
                if (_opened === true && !clickover.hasClass("navbar-toggler")) {
                    $(".navbar-toggler").click();
                }
            });
            
            
            $(document).click(function (event) {
                var clickover = $(event.target);
                var _opened = $('#SupportedContentProfil').css('display');
                if (_opened === 'block' && !clickover.hasClass("ProfilUser")) {
                    $("#SupportedContentProfil").css("display", "none");
                }
            });
            
            //User Profil
            $('#ProfilUser').click(function (event) {
                if($('#SupportedContentProfil').css('display') == 'none')
                    { 
                        $("#SupportedContentProfil").css("display", "block");
                    }else{ 
                        $("#SupportedContentProfil").css("display", "none");
                }
           });
           
           //Renseignement Telechargement
            $('.spantelechargement').click(function () {
                var courrier= $(this).attr('rel');
                var url =  '{{ path('telechargement_note') }}';
                var action ='@cruser$ab'; 
                var teleInfo= $( this ).hasClass( "teleInfo" )
               
                if(teleInfo){
                    $( this ).removeClass( "teleInfo" )
                    $.ajax({
                         url:url,
                         data:{
                             "id":courrier,
                             "action":action
                         },
                         success: function(response){
                             //alert(response.message);
                            $('#cr'+response.id).children().children().css("font-weight","");
                            var note = $(".note-number:first").html();
                            var recentnote = parseInt(note)-1;
                            if(recentnote<=0){
                                $(".note-number:first").html('');
                            }else{
                                $(".note-number:first").html(recentnote); 
                            }
                         },
                         error: function (request, status, error) {
                             alert(request.responseText);
                         }
                    });
                }  
            });
           
           //infoEntreprise infoCoffre creerCoffre
           //Ouverture et Fermeture Selon La Pagre  
           //ModalInfoCoffre  ModalNewCoffre ModalInfoEntreprise
             $('.infoCoffre').click(function () {
               $('#ModalInfoCoffre').show();
               $('#ModalNewCoffre').hide();
              
             });
             
             $('.creerCoffre').click(function () {
               $('#ModalInfoCoffre').hide();
               $('#ModalNewCoffre').show();
              
             });
             
            
             
             
            
    
    
    });
    
    
    {#var myDropzone = new Dropzone("#my-awesome-dropzone", { url: "/file/post"});
    Dropzone.autoDiscover = false;
#}
    
    //Empecher l'utilisation de la fleche de retour
   {# //window.history.forward();
    window.onload = function()
    {
      //window.history.forward();
    };
    window.onunload = function() {
      null;
    };#}
   
//   Section DropZone
    
{% if(is_granted('ROLE_ADMIN') or is_granted('ROLE_ENTREPRISE') or is_granted('ROLE_GUICHET')) %}  
                           
    //Real Time Logic
            var url = 'ws://'+ window.location.hostname +':9876/websocket'
            var server = new WebSocket(url)

            var TIMEOUT = 10;
            var lastTime = (new Date()).getTime();

            setInterval(function() {
              var currentTime = (new Date()).getTime();

              if (currentTime > (lastTime + TIMEOUT + 60)) {
                // Wake!
                 if (!isOpen(server)) {
                       // console.log('computer woke up!');
                        //window.location.reload();
                 }

              }
              lastTime = currentTime;
            }, TIMEOUT);
            
            
            
          //console.log(isOpen(server));
            
            function isOpen(ws) { 
                return ws.readyState === ws.OPEN 
            }
            
            
        //Suppression courriers
        $('body').on("click",'.supcourriers', function(){
            var url =$(this).attr('url');
            $("#modalFormSupp").attr("action", url);
            $("#myModal" ).css({'display':'block'});
            
            var categ = $( this ).hasClass( "categ" );
            //alert(categ);
            $("#modalInfoSupp").html(''); 
               var periode ='';
            if(!categ){
                periode = $(this).parent().parent().parent().children().first().html();
            }else{
                var valCateg =$(this).attr('rel');
                if(valCateg==1){
                   periode='Référencés'; 
                }
                else if(valCateg==2){
                 periode='Non Référencés';     
                }
                else{
                   periode='Ensemble';   
                }
               
            }
            $("#modalInfoSupp").html(periode);  
            
            
        });
        
        $( "#modalFormSupp" ).submit(function( event ) {
            event.preventDefault(); // avoid to execute the actual submit of the form.  
            var form = $(this);
            var url =  form.attr('action')
            
            $.ajax({
                url:url,
                success: function(response){
                    //alert(response.clientIDJson);
                       //server.send(JSON.stringify(response))
                     //location.reload(); 
                    response.forEach(element => server.send(JSON.stringify(element)));
                    location.reload(); 
                        //console.log(response);
                },
                error: function (request, status, error) {
                    alert('errorss');
                }
            });
        });
        
        //Autorisation Acces Attribution et Suppression
        $( ".form_acces" ).submit(function( event ) {
            event.preventDefault(); // avoid to execute the actual submit of the form. 

            //Recuperation Input Value
            var reference = $.trim($(this).find('.reference').val());
            var email = $(this).find('input[name="email"]').val();
            var service = $(this).find('input[name="service"]').val();
            
            var form = $(this);
            var urlaction =  form.attr('action')
            //alert(urlaction);


             //alert(service);

            //Affichage erreurs
            if(reference=='') {  
                $('#errorRefNull').show();                    
            } 
            if(!validateEmail(email)) {  
                $('#errorinvalid').show();                    
            }

            var url =  '{{ path('accces_controle') }}';
            var action ='@cruser$ab'; 
            $.ajax({
                    url:url,
                    data:{
                        "service":service,
                        "reference":reference,
                        "email":email,
                        "action":action
                    },
                    success: function(response){
                        if(response.message==1){
                            $('#errorfound').show();
                        }else if(response.message==2){
                                $('#errorfound').show();
                        }else if(response.message==3){
                                $('#errorRefAttr').show();
                        }
                        else{
                              //Send Autorisation
                                $.ajax({
                                    url:urlaction,
                                    data:{
                                        "email":email,
                                        "reference":reference,
                                        "action":action
                                    },
                                    success: function(response){
                                       //alert(response.message);
                                       response.forEach(element => server.send(JSON.stringify(element)));
                                       location.reload(); 
                                    },
                                    error: function (request, status, error) {
                                        alert(request.responseText);
                                    }
                                });
                        }                    

                    },
                    error: function (request, status, error) {
                        alert(request.responseText);
                    }
            });
        });
        
        //Suppression  Autorisation
        $('body').on("click",'#deleteAuto', function(){
            var url =$(this).attr('url');
            var action ='@cruser$ab'; 
            var serv = $(this).attr('rel');
            //alert(serv)
            $.ajax({
                url:url,
                data:{
                    "action":action
                },
                success: function(response){
                   //alert(response.message);
                   response.forEach(element => server.send(JSON.stringify(element)));
                   //location.reload(); 
                    var path = '{{path('accesreferenceservice_index')}}';
                    path= path+'?id='+serv;
                    
{#                  location.href = {{path('accesreferenceservice_index', { 'id': 1 })}};#}
        
                    window.location.href=path;
                },
                error: function (request, status, error) {
                    alert(request.responseText);
                }
            });
        });
        
       
        
    
    //Add in DropZone
    Dropzone.options.dropzoneFrom = {
        url: '{{path('courrierentreprise_new')}}', 
        autoProcessQueue:false,
        acceptedFiles:".pdf",
        autoDiscover: false, 
        init: function() {  
            var submitButton=document.querySelector('#submit-all');
            var totalFiles = 0;
            var myDropzone=this;
            
            submitButton.addEventListener("click", function(){
            myDropzone.processQueue();
            
            //alert(TIMEOUT);
                 
                
            });
            this.on("addedfile", function (file) {
                totalFiles += 1;
                document.getElementById('numberFilesUpload').innerHTML = totalFiles+' fichiers';
            });
            this.on("removedfile", function (file) {
                totalFiles -= 1;
                document.getElementById('numberFilesUpload').innerHTML = totalFiles+' fichiers';
            });
            this.on("success", function (file, response) {
                //server.send(JSON.stringify(response))
             // alert(response.routeDocJson);
                //console.dir(response);
               
                myDropzone.processQueue();
            });
            this.on('error', function(file, response) {
                   alert(response);
            });
            this.on("complete",function(){
                if(this.getQueuedFiles().length==0 && this.getUploadingFiles().length==0){
                    var _this=this;
                    _this.removeAllFiles();
                    location.reload(); 
                }
                
            });
        },
    };
    
    // Ouverture DropZone
    $("#opendropzonePDF").click(function(){    
        $("#dropzonePDF").show();
        //alert($(this).text());
        var textbutton =  $(this).text();
        if(textbutton=='Déposer'){
             $(this).text("Clore");
        }else{
            $(this).text("Déposer");
            $("#dropzonePDF").hide();
        }
       
        
    });
    //Vider DropZone
    $("#cleardropzonePDF").click(function(){    
      Dropzone.forElement('#dropzoneFrom').removeAllFiles(true);
    });
    
{% endif %}   
    
    
    
    
function validateEmail(email){
    var reg = /^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i;
    if(reg.test(email)){
        return true;
    }
    
    return false;
}

function ValidPhone(phone){
    if(phone.length<5){return false;}
    return true;
}

//Renseigne sur l'etat d'un email
//Disponible 0,  utilise 1  et introuvable 2
function stateEmail(email){
    
    var action ='@cruser$ab'; 
    var url =  '{{ path('email_find_state') }}';
    $.ajax({
            url:url,
            data:{
                "email":email,
                "action":action,
            },
            success: function(response){
                //alert(555);
                 return 1;
            },
            error: function (request, status, error) {
                return 2;
            }
    });
}

// Function is Int 
        function isInt(x) {
            var chars = decodeURI(x).trim().replace(' ', '').split('');
            var result=true;
            if(x==''){
                 result=false;
            }
            //var point=0;
            for (i = 0; i < chars.length; ++i) {
                
                  if(chars[i]!='0'){
                      if(!parseInt(chars[i])){
                        result=false;
                        break;
                    }
                  }  
            }
            return result;
        }
        
{#        //Controle Saisie Mot de Passe
var myInput = document.getElementById("password");

// When the user starts to type something inside the password field
myInput.onclick = function() {
  // Validate lowercase letters
  
    aler(2);
    }#}




// Get the modal
{#var modal = document.getElementById("myModal");
var divrappelpwd = document.getElementById("divrappelpwd");
// Get the button that opens the modal
var btn = document.getElementById("myBtn");
// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
// When the user clicks the button, open the modal 
btn.onclick = function() {
    //alert(2);
  modal.style.display = "block";
  divrappelpwd.style.display = "none";
}
// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
#}



            </script>
        
        {% endblock %}
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>         

    </body>
</html>
